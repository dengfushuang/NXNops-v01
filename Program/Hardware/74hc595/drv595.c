#include "drv595.h"
/**********************************************************************************************************
*文件名：drv595.c
*所在路径：driver/drv595.c
*创建时间: 2012-08-011
*功能描述: 放置74HC595驱动函数源文件
*作   者 ： 农晓明
*公   司 ： 光隆金宇
**********************************************************************************************************/

uint16_t LEDS=0XFFFF;
/*************************************************************************************************************
*函数名称：HC595_SendByte()
*参   数 ：uint8_t dat
*返回值  : void
*功能描述：给74HC595发送一个字节函数
**************************************************************************************************************/
void HC595_SendByte (uint16_t dat)
{
    uint8_t i = 16 ;
    while ( i -- )
    {
        HC595_SCLK_L;	//C595=0 ;                               //时钟线清零
        HC595_SER_H;	//D595=1 ;

        if ( dat&0x8000 )
        {
            HC595_SER_H;	//D595=1 ;             
        }
        else                        
        {
            HC595_SER_L;	//D595=0 ;
        }
        
        HC595_SCLK_H;	    //C595=1 ;                            //上跳
        dat <<= 1 ;                                               //左移一位
    }
}
/*************************************************************************************************************
*函数名称：HC595_Shift()
*参   数 ：uint8_t dat
*返回值  : void
*功能描述：给74HC595发送一个字节函数并加载
**************************************************************************************************************/
void HC595_Shift(uint16_t  dat)
{

    HC595_RCLK_L;	//R595=0;//寄存器控制线=1
    HC595_SendByte(dat);
    HC595_RCLK_H;	//R595=1;//产生脉冲使595中的数据显示出来
}
/*************************************************************************************************************
*函数名称：ChannelLED()
*参   数 ： uint8_t i: 0~15 分别表示 0~15 对应的通道，16表示所有的通道
             uint8_t w: w=0灭，w=1亮;
*返回值  : 无
*功能描述：LED通道控制，外部调用
**************************************************************************************************************/
void ChannelLED(uint8_t i ,uint8_t w)
{
    if(i<=15)
    {
        if(w==0)		LEDS |= (1U<<i);          //灭
        else if(w==1)	LEDS &= (~(1U<<i));       //亮
    }
    else if(i==16)                                  //所有通道LED
    {
        if(w==0)		LEDS=0xffff;                //全灭
        else if(w==1)	LEDS=0x0000;                //全亮
    }
    HC595_Shift(LEDS);
}
